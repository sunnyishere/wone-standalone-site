<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:fragment="commonHead">
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="author" content="http://m.iwone.cn/"/>
    <link rel="stylesheet" th:href="@{https://oss.iwone.cn/standalone/css/amazeui.min.css(v=${version})}">
    <link rel="stylesheet" th:href="@{https://oss.iwone.cn/standalone/css/iconfont2.css(v=${version})}">
    <link rel="stylesheet" th:href="@{https://oss.iwone.cn/standalone/css/iconfont.css(v=${version})}">
    <link rel="stylesheet" th:href="@{https://oss.iwone.cn/standalone/css/style.css(v=${version})}">

    <!-- JavaScript 资源 -->
    <script src="https://oss.iwone.cn/standalone/js/jquery.min.js"></script>
    <script src="https://oss.iwone.cn/standalone/js/amazeui.min.js"></script>
    <script src="https://oss.iwone.cn/standalone/js/jquery.qrcode.min.js"></script>
    <script src="https://oss.iwone.cn/standalone/js/echo.min.js"></script>
    <script src="https://oss.iwone.cn/standalone/js/main.js"></script>
    <script src="https://oss.iwone.cn/landing/js/appDownload.js"></script>
    <link rel="icon" type="image/x-icon" th:href="${prodBrand.icon}">
    <link rel="icon" type="image/png" th:href="${prodBrand.icon}">
    <link rel="shortcut icon" th:href="${prodBrand.icon}">
    <script th:inline="javascript">
        $(function () {
            // 1. 解析Thymeleaf变量（带默认值）
            var fontColor = /*[[${fontColor}]]*/ "#FF5656";
            var headColor = /*[[${headColor}]]*/ "#FFFFFF";
            var headFontColor = /*[[${headFontColor}]]*/ "#000000";
            var otherHeadFontColor = /*[[${otherHeadFontColor}]]*/ "#000000";

            // 2. 设置到根元素（全局生效）
            document.documentElement.style.setProperty("--theme-wone", fontColor);
            document.documentElement.style.setProperty("--theme-header-bg", headFontColor);
            document.documentElement.style.setProperty("--theme-header-color", headColor);
            document.documentElement.style.setProperty("--theme-menu-font-color", otherHeadFontColor);
        })
    </script>

    <script>
        $(function () {
            $(document).on('click', '#search-button', function (event) {
                event.preventDefault();
                event.stopPropagation();

                const searchInput = $('.search-input');
                const searchTerm = searchInput.val().trim().replace(/\s+/g, '-');
                if (!searchTerm) {
                    alert('Please enter keywords');
                    searchInput.focus();
                    return;
                }

                const encodedTerm = encodeURIComponent(searchTerm);
                const targetUrl = `/search-${encodedTerm}`;

                console.log(`搜索关键词: ${searchTerm}`);
                console.log(`跳转URL: ${targetUrl}`);

                window.location.href = targetUrl;

                searchInput.val('').attr('placeholder', 'Search Products...');
                setTimeout(() => {
                    searchInput.attr('placeholder', 'Search Products...');
                }, 1000);
            });

            $(document).on('keypress', '.search-input', function (e) {
                if (e.key === 'Enter') {
                    console.log('【输入框回车】事件触发');
                    e.preventDefault();
                    $('#search-button').trigger('click');
                }
            });
        });
    </script>


    <script>
        $(document).ready(function () {
            $(document).on('click', 'a[data-trigger="modal-1"], div[data-trigger="modal-1"]', function (e) {
                e.preventDefault();
                // 获取传递的bizId值
                const bizId = $(this).data('biz-id');
                // 设置到隐藏字段
                $('#input-biz-id').val(bizId);
                // 在表单中显示（可选）
                $('#param-value').text(bizId);
            });
        });
    </script>
    <!--   rfq 提交 -->
    <script>
        jQuery(function ($) {
            function showError($input, errorMsg) {
                const $error = $('<div class="form-error" style="color: red; margin-top: 5px; font-size: 12px;">' + errorMsg + '</div>');
                $input.closest('.am-form-group').append($error);
            }

            function showNativeMsg(content) {
                const oldMsg = document.getElementById('native-msg');
                if (oldMsg) oldMsg.remove();

                const msgElem = document.createElement('div');
                msgElem.id = 'native-msg';
                msgElem.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                padding: 12px 24px;
                background: rgba(0, 0, 0, 0.7);
                color: #fff;
                border-radius: 6px;
                font-size: 14px;
                z-index: 9999; /* 确保在最上层 */
                transition: opacity 0.3s ease;
            `;
                msgElem.textContent = content;

                document.body.appendChild(msgElem);

                setTimeout(() => {
                    msgElem.style.opacity = '0';
                    setTimeout(() => msgElem.remove(), 300);
                }, 2000);
            }

            $('#doc-modal-1 button[style*="background-color: var(--theme-wone)"]').on('click', function () {
                $('.form-error').remove();

                // 获取表单数据
                const formData = {
                    bizId: $('#input-biz-id').val(),
                    name: $('#input-name').val(),
                    phone: $('#input-phone').val(),
                    email: $('#input-email').val(),
                    country: $('#input-country').val(),
                    message: $('#input-message').val()
                };

                let hasError = false;

                if (!formData.name.trim()) {
                    showError($('#input-name'), 'Please enter your name');
                    hasError = true;
                }

                if (!formData.phone.trim()) {
                    showError($('#input-phone'), 'Please enter your phone number');
                    hasError = true;
                }

                if (!formData.email.trim()) {
                    showError($('#input-email'), 'Please enter your email');
                    hasError = true;
                } else if (!/\S+@\S+\.\S+/.test(formData.email)) {
                    showError($('#input-email'), 'Please enter a valid email address');
                    hasError = true;
                }

                if (!formData.country.trim()) {
                    showError($('#input-country'), 'Please enter your country');
                    hasError = true;
                }

                if (!formData.message.trim()) {
                    showError($('#input-message'), 'Please enter your message');
                    hasError = true;
                }

                if (hasError) {
                    return;
                }

                const xhr = new XMLHttpRequest();
                xhr.open('POST', "/leaveMessage", true);
                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');

                xhr.onload = function () {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        try {
                            const result = JSON.parse(xhr.responseText);
                            if (result && result.code === 200) {
                                showNativeMsg("Submission successful!");
                                setTimeout(function () {
                                    location.reload();
                                }, 500);
                            } else {
                                showNativeMsg(result?.msg || "Failed to submit the form. Please try again later.");
                            }
                        } catch (e) {
                            showNativeMsg("Invalid response from server");
                        }
                    } else {
                        showNativeMsg("Server error: " + xhr.statusText);
                    }
                };

                xhr.onerror = function () {
                    showNativeMsg("Network error, please try again.");
                };

                const formDataParams = Object.keys(formData).map(key =>
                    encodeURIComponent(key) + '=' + encodeURIComponent(formData[key])
                ).join('&');

                xhr.send(formDataParams);
            });
        });
    </script>
</head>
</html>